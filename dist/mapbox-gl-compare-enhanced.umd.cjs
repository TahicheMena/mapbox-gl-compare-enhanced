(function(E,w){typeof exports=="object"&&typeof module<"u"?module.exports=w():typeof define=="function"&&define.amd?define(w):(E=typeof globalThis<"u"?globalThis:E||self,E.Compare=w())})(this,function(){"use strict";function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var w={exports:{}};(function(e){var s=Object.prototype.hasOwnProperty,h="~";function l(){}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(h=!1));function d(i,o,n){this.fn=i,this.context=o,this.once=n||!1}function p(i,o,n,r,_){if(typeof n!="function")throw new TypeError("The listener must be a function");var f=new d(n,r||i,_),u=h?h+o:o;return i._events[u]?i._events[u].fn?i._events[u]=[i._events[u],f]:i._events[u].push(f):(i._events[u]=f,i._eventsCount++),i}function m(i,o){--i._eventsCount===0?i._events=new l:delete i._events[o]}function c(){this._events=new l,this._eventsCount=0}c.prototype.eventNames=function(){var o=[],n,r;if(this._eventsCount===0)return o;for(r in n=this._events)s.call(n,r)&&o.push(h?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(n)):o},c.prototype.listeners=function(o){var n=h?h+o:o,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var _=0,f=r.length,u=new Array(f);_<f;_++)u[_]=r[_].fn;return u},c.prototype.listenerCount=function(o){var n=h?h+o:o,r=this._events[n];return r?r.fn?1:r.length:0},c.prototype.emit=function(o,n,r,_,f,u){var v=h?h+o:o;if(!this._events[v])return!1;var t=this._events[v],g=arguments.length,y,a;if(t.fn){switch(t.once&&this.removeListener(o,t.fn,void 0,!0),g){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,n),!0;case 3:return t.fn.call(t.context,n,r),!0;case 4:return t.fn.call(t.context,n,r,_),!0;case 5:return t.fn.call(t.context,n,r,_,f),!0;case 6:return t.fn.call(t.context,n,r,_,f,u),!0}for(a=1,y=new Array(g-1);a<g;a++)y[a-1]=arguments[a];t.fn.apply(t.context,y)}else{var O=t.length,b;for(a=0;a<O;a++)switch(t[a].once&&this.removeListener(o,t[a].fn,void 0,!0),g){case 1:t[a].fn.call(t[a].context);break;case 2:t[a].fn.call(t[a].context,n);break;case 3:t[a].fn.call(t[a].context,n,r);break;case 4:t[a].fn.call(t[a].context,n,r,_);break;default:if(!y)for(b=1,y=new Array(g-1);b<g;b++)y[b-1]=arguments[b];t[a].fn.apply(t[a].context,y)}}return!0},c.prototype.on=function(o,n,r){return p(this,o,n,r,!1)},c.prototype.once=function(o,n,r){return p(this,o,n,r,!0)},c.prototype.removeListener=function(o,n,r,_){var f=h?h+o:o;if(!this._events[f])return this;if(!n)return m(this,f),this;var u=this._events[f];if(u.fn)u.fn===n&&(!_||u.once)&&(!r||u.context===r)&&m(this,f);else{for(var v=0,t=[],g=u.length;v<g;v++)(u[v].fn!==n||_&&!u[v].once||r&&u[v].context!==r)&&t.push(u[v]);t.length?this._events[f]=t.length===1?t[0]:t:m(this,f)}return this},c.prototype.removeAllListeners=function(o){var n;return o?(n=h?h+o:o,this._events[n]&&m(this,n)):(this._events=new l,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=h,c.EventEmitter=c,e.exports=c})(w);var x=w.exports;const L=E(x);function M(e,s){var h=e.getCenter(),l=e.getZoom(),d=e.getBearing(),p=e.getPitch();s.forEach(function(m){m.jumpTo({center:h,zoom:l,bearing:d,pitch:p})})}function P(){var e,s=arguments.length;if(s===1)e=arguments[0];else{e=[];for(var h=0;h<s;h++)e.push(arguments[h])}var l=[];e.forEach(function(c,i){l[i]=m.bind(null,c,e.filter(function(o,n){return n!==i}))});function d(){e.forEach(function(c,i){c.on("move",l[i])})}function p(){e.forEach(function(c,i){c.off("move",l[i])})}function m(c,i){p(),M(c,i),d()}return d(),function(){p(),l=[],e=[]}}var z=P;const T=E(z);function C(e,s,h,l){if(this.options=l||{},this._mapA=e,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new L,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"mapboxgl-compare mapboxgl-compare-horizontal":"mapboxgl-compare",this._controlContainer.appendChild(this._swiper),typeof h=="string"&&document.body.querySelectorAll){const p=document.body.querySelectorAll(h)[0];if(!p)throw new Error("Cannot find element with specified container selector.");p.appendChild(this._controlContainer)}else if(h instanceof Element&&h.appendChild)h.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();const d=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(d),this._clearSync=T(e,s),this._onResize=()=>{this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)},s.on("resize",this._onResize),this.options.mousemove&&(e.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}return C.prototype={_setPointerEvents(e){this._controlContainer.style.pointerEvents=e,this._swiper.style.pointerEvents=e},_onDown(e){e.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition(e){e=Math.min(e,this._horizontal?this._bounds.height:this._bounds.width);const s=this._horizontal?`translate(0, ${e}px)`:`translate(${e}px, 0)`;this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;const h=this._horizontal?`rect(0, 999em, ${e}px, 0)`:`rect(0, ${e}px, ${this._bounds.height}px, 0)`,l=this._horizontal?`rect(${e}px, 999em, ${this._bounds.height}px,0)`:`rect(0, 999em, ${this._bounds.height}px, ${e}px)`;this._mapA.getContainer().style.clip=h,this._mapB.getContainer().style.clip=l,this.currentPosition=e},_onMove(e){this.options.mousemove&&this._setPointerEvents(e.touches?"auto":"none");const s=this._horizontal?this._getY(e):this._getX(e);this._setPosition(s)},_onMouseUp(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX(e){e=e.touches?e.touches[0]:e;let s=e.clientX-this._bounds.left;return Math.max(0,Math.min(s,this._bounds.width))},_getY(e){e=e.touches?e.touches[0]:e;let s=e.clientY-this._bounds.top;return Math.max(0,Math.min(s,this._bounds.height))},setSlider(e){this._setPosition(e)},on(e,s){return this._ev.on(e,s),this},fire(e,s){return this._ev.emit(e,s),this},off(e,s){return this._ev.removeListener(e,s),this},remove(){this._clearSync(),this._mapB.off("resize",this._onResize);const e=this._mapA.getContainer();e&&(e.style.clip=null,e.removeEventListener("mousemove",this._onMove));const s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},C});
